<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>{{ book.title }}</title>
    <link rel="stylesheet" href="{{ plugin_url }}css/style.css" />
    <link rel="stylesheet" href="{{ plugin_url }}css/paged.css" media="print" />
    <script src="https://unpkg.com/pagedjs/dist/paged.polyfill.js"></script>
    {% set google_fonts = {
        'Source Serif Pro': 'Source+Serif+Pro',
        'Crimson Text': 'Crimson+Text',
        'Libre Baskerville': 'Libre+Baskerville',
        'PT Serif': 'PT+Serif'
    } %}
    {% set loaded_fonts = [] %}
    {% if template.font_family in google_fonts %}
    <link href="https://fonts.googleapis.com/css2?family={{ google_fonts[template.font_family] }}&display=swap" rel="stylesheet" />
    {% set loaded_fonts = loaded_fonts|merge([template.font_family]) %}
    {% endif %}
    {% for i in 1..5 %}
        {% set hf = attribute(template, 'h' ~ i ~ '_font') %}
        {% if hf in google_fonts and hf not in loaded_fonts %}
    <link href="https://fonts.googleapis.com/css2?family={{ google_fonts[hf] }}&display=swap" rel="stylesheet" />
    {% set loaded_fonts = loaded_fonts|merge([hf]) %}
        {% endif %}
    {% endfor %}
    {% if template.doc_format or template.doc_width or template.font_family or template.font_size or template.line_height or template.text_color or template.background_color
        or template.h1_font or template.h1_color or template.h1_background_color or template.h1_font_size or template.h1_line_height
        or template.h2_font or template.h2_color or template.h2_background_color or template.h2_font_size or template.h2_line_height
        or template.h3_font or template.h3_color or template.h3_background_color or template.h3_font_size or template.h3_line_height
        or template.h4_font or template.h4_color or template.h4_background_color or template.h4_font_size or template.h4_line_height
        or template.h5_font or template.h5_color or template.h5_background_color or template.h5_font_size or template.h5_line_height %}
    <style>
    {% set text_unit = template.text_unit ?: 'pt' %}
    {% set doc_unit = template.doc_unit ?: 'mm' %}
    {% set page_unit = doc_unit %}
    {% if template.doc_format and template.doc_format != 'Custom' %}
        {% set sizes = {
            'A4': [210, 297],
            'A5': [148, 210],
            'Letter': [216, 279]
        } %}
        {% set page_width = sizes[template.doc_format][0] %}
        {% set page_height = sizes[template.doc_format][1] %}
        {% if template.doc_orientation == 'landscape' %}
            {% set temp = page_width %}
            {% set page_width = page_height %}
            {% set page_height = temp %}
        {% endif %}
        {% set page_unit = 'mm' %}
    {% elseif template.doc_width and template.doc_height %}
        {% set page_width = template.doc_width %}
        {% set page_height = template.doc_height %}
    {% endif %}
    {% set has_margin = (template.doc_margin_top is not same as(null) and template.doc_margin_top is not same as('')) or
        (template.doc_margin_right is not same as(null) and template.doc_margin_right is not same as('')) or
        (template.doc_margin_bottom is not same as(null) and template.doc_margin_bottom is not same as('')) or
        (template.doc_margin_left is not same as(null) and template.doc_margin_left is not same as('')) %}
    @page {
        {% if template.doc_format and template.doc_format != 'Custom' %}
        size: {{ template.doc_format }}{% if template.doc_orientation %} {{ template.doc_orientation }}{% endif %};
        {% elseif template.doc_width and template.doc_height %}
        size: {{ template.doc_width }}{{ template.doc_unit }} {{ template.doc_height }}{{ template.doc_unit }}{% if template.doc_orientation %} {{ template.doc_orientation }}{% endif %};
        {% endif %}
        {% if has_margin %}
        margin: {{ template.doc_margin_top|default(0) }}{{ doc_unit }} {{ template.doc_margin_right|default(0) }}{{ doc_unit }} {{ template.doc_margin_bottom|default(0) }}{{ doc_unit }} {{ template.doc_margin_left|default(0) }}{{ doc_unit }};
        {% endif %}
    }
    body {
        {% if page_width and page_height %}width: {{ page_width }}{{ page_unit }}; height: {{ page_height }}{{ page_unit }};{% endif %}
        margin: 0;
        padding: 0;
        {% if template.font_family %}font-family: '{{ template.font_family }}', serif !important;{% endif %}
        {% if template.font_size %}font-size: {{ template.font_size }}{{ text_unit }};{% endif %}
        {% if template.line_height %}line-height: {{ template.line_height }}{{ text_unit }};{% endif %}
        {% if template.text_color %}color: {{ template.text_color }};{% endif %}
        {% if template.background_color %}background-color: {{ template.background_color }};{% endif %}
        {% if template.text_align %}text-align: {{ template.text_align }};{% endif %}
        {% if template.show_border %}border: 1px solid #ccc; box-sizing: border-box;{% endif %}
    }
    {% for i in 1..5 %}
    h{{ i }}, h{{ i }}[data-align-last-split-element] {
        {% set hf = attribute(template, 'h' ~ i ~ '_font') %}
        {% if hf %}font-family: '{{ hf }}', sans-serif;{% endif %}
        {% set hc = attribute(template, 'h' ~ i ~ '_color') %}
        {% if hc %}color: {{ hc }};{% endif %}
        {% set hbg = attribute(template, 'h' ~ i ~ '_background_color') %}
        {% if hbg %}background-color: {{ hbg }};{% endif %}
        {% set hfs = attribute(template, 'h' ~ i ~ '_font_size') %}
        {% if hfs %}font-size: {{ hfs }}{{ text_unit }};{% endif %}
        {% set hlh = attribute(template, 'h' ~ i ~ '_line_height') %}
        {% if hlh %}line-height: {{ hlh }}{{ text_unit }};{% endif %}
        {% set ha = attribute(template, 'h' ~ i ~ '_align') %}
        {% if ha %}text-align: {{ ha }};{% endif %}
    }
    {% endfor %}
    code, pre {
        font-family: 'Courier New', Courier, monospace;
    }
    </style>
    {% endif %}
 </head>
 <body>
 {% if book.cover %}<img src="{{ book.cover }}" alt="Cover" class="cover" />{% endif %}
 <div class="title-page">
     {% if book.author %}<p class="author">{{ book.author }}</p>{% endif %}
     {% if book.coauthors %}<p class="coauthors">{{ book.coauthors }}</p>{% endif %}
     <h1>{{ book.title }}</h1>
     {% if book.subtitle %}<h2>{{ book.subtitle }}</h2>{% endif %}
     {% if book.frontispiece %}<div class="frontispiece">{{ book.frontispiece|raw }}</div>{% endif %}
 </div>
 {% if book.preface %}<div class="preface">{{ book.preface|raw }}</div>{% endif %}
 <nav class="bc-nav">
     <ul>
         <li><a href="#identification">Identification</a></li>
         <li><a href="#descriptive">Descriptive</a></li>
         <li><a href="#preliminary">Preliminary Parts</a></li>
         <li><a href="#chapters">Chapters</a></li>
         <li><a href="#final">Final Parts</a></li>
     </ul>
 </nav>

 <section id="identification">
     {% if book.publisher %}<p class="publisher">{{ book.publisher }}</p>{% endif %}
     {% if book.isbn %}<p class="isbn">ISBN: {{ book.isbn }}</p>{% endif %}
     {% if book.pub_date %}<p class="pub-date">{{ book.pub_date }}</p>{% endif %}
     {% if book.edition %}<p class="edition">{{ book.edition }}</p>{% endif %}
 </section>

 <section id="descriptive">
     {% if book.language %}<p class="language">{{ book.language }}</p>{% endif %}
     {% if book.description %}<div class="description">{{ book.description|raw }}</div>{% endif %}
     {% if book.keywords %}<p class="keywords">{{ book.keywords }}</p>{% endif %}
     {% if book.audience %}<p class="audience">{{ book.audience }}</p>{% endif %}
 </section>

 <section id="preliminary">
     {% if book.copyright %}<div class="copyright">{{ book.copyright|raw }}</div>{% endif %}
     {% if book.dedication %}<div class="dedication">{{ book.dedication|raw }}</div>{% endif %}
 </section>

 <section id="chapters">
     {% for chapter in chapters %}
     <article class="chapter">
         <h2>{{ chapter.title }}</h2>
         {% if chapter.content %}<div class="chapter-content">{{ chapter.content|raw }}</div>{% endif %}
         {% for paragraph in chapter.paragraphs %}
         <div class="paragraph">
             <h3>{{ paragraph.title }}</h3>
             <div class="paragraph-content">{{ paragraph.content|raw }}</div>
         </div>
         {% endfor %}
     </article>
     {% endfor %}
 </section>

 <section id="final">
     {% if book.appendix %}<div class="appendix">{{ book.appendix|raw }}</div>{% endif %}
     {% if book.bibliography %}<div class="bibliography">{{ book.bibliography|raw }}</div>{% endif %}
     {% if book.author_note %}<div class="author-note">{{ book.author_note|raw }}</div>{% endif %}
 </section>
 </body>
</html>
